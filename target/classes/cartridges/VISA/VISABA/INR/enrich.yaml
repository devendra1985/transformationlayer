# ============================================================================
# VISA VISABA INR - Enrichment Rules
# ============================================================================

cartridgeId: VISABA-INR

rules:
  # Payout method constant (Visa Direct Account)
  - set:
      target: payoutMethod
      value: "B"

  # Sender/recipient type mapping
  - when:
      path: $.recipientType
      equals: "B"
    set:
      target: recipientDetail.type
      value: "C"

  - when:
      path: $.recipientType
      equals: "I"
    set:
      target: recipientDetail.type
      value: "I"

  - set:
      target: senderDetail.type
      value: "C"

  # Account number type defaults
  - when:
      path: $.cdtrAcctIban
      exists: true
    set:
      target: recipientDetail.bank.accountNumberType
      value: "IBAN"

  - when:
      path: $.cdtrAcctIban
      exists: false
    set:
      target: recipientDetail.bank.accountNumberType
      value: "DEFAULT"

  # INR-specific: Bank code type is IFSC for India
  - set:
      target: recipientDetail.bank.bankCodeType
      value: "IFSC"

  # INR-specific defaults
  - set:
      target: recipientDetail.bank.currencyCode
      value: "INR"

  - set:
      target: transactionDetail.settlementCurrencyCode
      value: "INR"

  # Business application defaults
  - set:
      target: transactionDetail.businessApplicationId
      value: "FD"

  - set:
      target: transactionDetail.senderSourceOfFunds
      value: "05"

  - set:
      target: transactionDetail.initiatingPartyId
      value: 1002

  # INR-specific: Country code for India
  - set:
      target: recipientDetail.bank.countryCode
      value: "IND"
